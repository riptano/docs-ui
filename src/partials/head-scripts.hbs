{{!-- IBM Analytics Configuration with TrustArc Consent Management --}}
{{!-- Only loads when site.keys.ibmSegment is set --}}
{{#with site.keys.ibmSegment}}
<script>
  window._ibmAnalytics = {
    "settings": {
      "name": "DataStax",
      "tealiumProfileName": "ibm-subsidiary",
    },
    "trustarc": {
      "privacyPolicyLink": "https://ibm.com/privacy"
    },
    "digitalData.page.services.google.enabled": true
  };

  /**
   * Shared Segment Common Properties
   * Single source of truth for all common properties included in Segment events
   * Conforms to IBM Cloud Platform Analytics schema
   */
  window.SEGMENT_COMMON_PROPERTIES = {
    productTitle: "watsonx.data",
    productCode: "WW1544",
    productCodeType: "WWPC",
    UT30: "30AW0",
    instanceId: "docs-site",
    subscriptionId: "public-access",
    userId: "IBMid-ANONYMOUS",
  };

  window.digitalData = {
    "page": {
      "pageInfo": {
        "ibm": {
          "siteId": "IBM_" + _ibmAnalytics.settings.name,
        },
        "segment": {
          "enabled": true,
          "env": "prod",
          "key": "{{this}}",
          "coremetrics": false,
          "carbonComponentEvents": false,
          "commonProperties": window.SEGMENT_COMMON_PROPERTIES
        }
      },
      "category": {
        "primaryCategory": "PC230"
      }
    }
  };

  /**
   * Get common properties for Segment events
   * @param {string} eventType - The type of event ('CTA Clicked', 'UI Interaction', 'User Form', 'page', etc.)
   * @returns {object} Common properties including userId for all events
   */
  window.getSegmentCommonProperties = function(eventType) {
    return {
      ...window.SEGMENT_COMMON_PROPERTIES
    };
  };

</script>
<script src="//1.www.s81c.com/common/stats/ibm-common.js" async></script>
{{/with}}

<script>var uiRootPath = '{{{uiRootPath}}}'</script>

<script>
  function setTheme() {
    var localStorage = window.localStorage.getItem("themePreference");
    var systemPreference = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";

    if (localStorage !== "dark" && localStorage !== "light") {
      document.documentElement.setAttribute("data-theme", systemPreference);
      document.documentElement.setAttribute("data-theme-system", true);
      window.localStorage.removeItem("themePreference");
    } else {
      document.documentElement.setAttribute("data-theme", localStorage);
    }
  };
  setTheme();
</script>
